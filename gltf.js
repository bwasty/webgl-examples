!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("gloperate"));else if("function"==typeof define&&define.amd)define(["gloperate"],t);else{var r="object"==typeof exports?t(require("gloperate")):t(e.gloperate);for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(t,r){t.exports=e},function(e,t,r){"use strict"},,,,function(e,t){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=r(3),i=r(5),s=r(4),a=r(2),u=r(1);t.GltfLoader=class{constructor(e){this.manager=e||new u.LoadingManager}load(e,t){return n(this,void 0,void 0,function*(){const r=a.LoaderUtils.extractUrlBase(e),n=new o.FileLoader(this.manager);n.responseType="arraybuffer";const i=yield n.load(e,t);return yield this.parse(i,r)})}loadFromFiles(e){return n(this,void 0,void 0,function*(){let t,r;for(const[n,o]of e)o.name.match(/\.(gltf|glb)$/)&&(t=o,r=n.replace(o.name,""));if(!t)throw new Error("No .gltf or .glb asset found.");const n="string"==typeof t?t:URL.createObjectURL(t),o=a.LoaderUtils.extractUrlBase(n),i=[];this.manager.urlModifier=(t=>{const n=r+t.replace(o,"").replace(/^(\.?\/)/,"");if(e.has(n)){const t=e.get(n),r=URL.createObjectURL(t);return i.push(r),r}return t});const s=yield this.load(n);return yield s.fetchAll(),URL.revokeObjectURL(n),i.forEach(URL.revokeObjectURL),s})}parse(e,r){return n(this,void 0,void 0,function*(){let n;const o={};"string"==typeof e?n=e:a.LoaderUtils.decodeText(new Uint8Array(e,0,4))===i.BINARY_EXTENSION_HEADER_MAGIC?(o[t.EXTENSIONS.KHR_BINARY_GLTF]=new i.GLTFBinaryExtension(e),n=o[t.EXTENSIONS.KHR_BINARY_GLTF].content):n=a.LoaderUtils.decodeText(new Uint8Array(e));const u=JSON.parse(n);if(void 0===u.asset||u.asset.version[0]<2)throw new Error("Unsupported asset. glTF versions >=2.0 are supported.");return new s.GltfAsset(u,r||"",o,this.manager)})}},t.EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingManager=class{constructor(){this.urlModifier=void 0,this.onStart=void 0,this.onProgress=void 0,this.onLoad=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0}itemStart(e){this.itemsTotal++,!this.isLoading&&this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0}itemEnd(e){this.itemsLoaded++,this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,this.onLoad&&this.onLoad())}itemError(e){this.onError&&this.onError(e)}resolveURL(e){return this.urlModifier?this.urlModifier(e):e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoaderUtils=class{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(const r of e)t+=String.fromCharCode(r);return decodeURIComponent(escape(t))}static extractUrlBase(e){const t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileLoader=class{constructor(e){this.manager=e}load(e,t){return void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e),new Promise((r,n)=>{const o=new XMLHttpRequest;o.open("GET",e,!0);const i=this;o.onload=function(t){const s=this.response;0===this.status?(console.warn("FileLoader: HTTP Status 0 received."),r(s),i.manager.itemEnd(e)):200===this.status?(r(s),i.manager.itemEnd(e)):(n({status:this.status,statusText:o.statusText}),i.manager.itemEnd(e),i.manager.itemError(e))},o.onprogress=(e=>{t&&t(e)}),o.onerror=function(t){n({status:this.status,statusText:o.statusText}),i.manager.itemEnd(e),i.manager.itemError(e)},this.responseType&&(o.responseType=this.responseType),this.withCredentials&&(o.withCredentials=this.withCredentials),this.mimeType&&o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeaders)o.setRequestHeader(e,this.requestHeaders[e]);o.send(null),this.manager.itemStart(e)})}setRequestHeader(e,t){return this.requestHeaders[e]=t,this}}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=r(3),i=r(0),s=r(1);t.GltfAsset=class{constructor(e,t,r,n=new s.LoadingManager){this.gltf=e,this.extensions=r,this.bufferData=new a(this,t,n),this.imageData=new u(this,t,n)}bufferViewData(e){return n(this,void 0,void 0,function*(){if(!this.gltf.bufferViews)throw new Error("No buffer views found.");const t=this.gltf.bufferViews[e],r=yield this.bufferData.get(t.buffer),n=t.byteLength||0,o=t.byteOffset||0;return r.slice(o,o+n)})}fetchAll(){return n(this,void 0,void 0,function*(){return Promise.all([this.bufferData.fetchAll(),this.imageData.fetchAll()])})}};class a{constructor(e,t,r){this.bufferCache=[],this.asset=e,this.baseUri=t,this.manager=r,this.loader=new o.FileLoader(r),this.loader.responseType="arraybuffer"}get(e){return n(this,void 0,void 0,function*(){if(void 0!==this.bufferCache[e])return this.bufferCache[e];const t=this.asset.gltf;if(!t.buffers)throw new Error("No buffers found.");const r=t.buffers[e];if(void 0===r.uri){if(0!==e)throw new Error("GLB container is required to be the first buffer");return this.asset.extensions[i.EXTENSIONS.KHR_BINARY_GLTF].body}const n=c(r.uri,this.baseUri),o=yield this.loader.load(n);return this.bufferCache[e]=o,o})}fetchAll(){return n(this,void 0,void 0,function*(){const e=this.asset.gltf.buffers;return e?Promise.all(e.map((e,t)=>this.get(t))):[]})}}t.BufferData=a;class u{constructor(e,t,r){this.imageCache=[],this.asset=e,this.baseUri=t,this.manager=r}get(e){return n(this,void 0,void 0,function*(){if(void 0!==this.imageCache[e])return this.imageCache[e];const t=this.asset.gltf;if(!t.images)throw new Error("No images found.");const r=t.images[e];let n,o=!1;if(void 0!==r.bufferView){const e=yield this.asset.bufferViewData(r.bufferView);o=!0;const t=new Blob([e],{type:r.mimeType});n=URL.createObjectURL(t)}else{if(void 0===r.uri)throw new Error("Invalid glTF: image must either have a `uri` or a `bufferView`");n=this.manager.resolveURL(c(r.uri,this.baseUri))}const i=new Image;return new Promise((t,r)=>{i.onerror=(()=>{r(`Failed to load ${n}`),this.manager.itemEnd(n),this.manager.itemError(n)}),i.onload=(()=>{o&&URL.revokeObjectURL(n),this.imageCache[e]=i,t(i),this.manager.itemEnd(n)}),i.src=n,this.manager.itemStart(n)})})}fetchAll(){return n(this,void 0,void 0,function*(){const e=this.asset.gltf.images;return e?Promise.all(e.map((e,t)=>this.get(t))):[]})}}function c(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}t.ImageData=u,t.resolveURL=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),o=r(2);t.BINARY_EXTENSION_HEADER_MAGIC="glTF";const i=1313821514,s=5130562;t.GLTFBinaryExtension=class{constructor(e){this.name=n.EXTENSIONS.KHR_BINARY_GLTF;const r=new DataView(e,0,12);if(this.header={magic:o.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==t.BINARY_EXTENSION_HEADER_MAGIC)throw new Error("Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("Unsupported legacy binary file detected.");const a=new DataView(e,12);let u=0;for(;u<a.byteLength;){const t=a.getUint32(u,!0);u+=4;const r=a.getUint32(u,!0);if(u+=4,r===i){const r=new Uint8Array(e,12+u,t);this.content=o.LoaderUtils.decodeText(r)}else if(r===s){const r=12+u;this.body=e.slice(r,r+t)}u+=t}if(null===this.content)throw new Error("glTF-Binary: JSON content not found.")}}},function(e,t,r){e.exports=r(0)}])},function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onInitialize=function(e,t,r){return!0},t.prototype.onUninitialize=function(){console.error("Method not implemented.")},t.prototype.onUpdate=function(){return console.error("Method not implemented."),!1},t.prototype.onPrepare=function(){console.error("Method not implemented.")},t.prototype.onFrame=function(e){console.error("Method not implemented.")},t.prototype.onSwap=function(){console.error("Method not implemented.")},t}(r(0).Renderer);t.GltfRenderer=i},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=r(6),a=r(5);function u(){var e=new i.Canvas("example-canvas"),t=e.context,r=new s.GltfRenderer;e.renderer=r,e.element.addEventListener("click",function(){return i.viewer.Fullscreen.toggle(e.element)}),e.element.addEventListener("touchstart",function(){return i.viewer.Fullscreen.toggle(e.element)}),function(e){n(this,void 0,void 0,function(){var e,t,r;return o(this,function(n){switch(n.label){case 0:return e=new a.GltfLoader,t="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BoxTextured/glTF/BoxTextured.gltf",[4,e.load(t)];case 1:return[4,(r=n.sent()).fetchAll()];case 2:return n.sent(),console.log("loaded "+t,r),window.asset=r,[2]}})})}(),window.canvas=e,window.context=t,window.renderer=r}"complete"===window.document.readyState?u():window.onload=u},function(e,t,r){r(1),e.exports=r(7)}])});
//# sourceMappingURL=gltf.js.map